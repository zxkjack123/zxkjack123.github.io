<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.jpg">
  <link rel="mask-icon" href="/images/favicon.jpg" color="#222">
  <meta name="google-site-verification" content="JHEEEyylS4g-v_hhF-L1a1mgp9itS98C5jDANE-2PGs">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zxkjack123.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="None">
<meta property="og:type" content="article">
<meta property="og:title" content="使用PyNE进行基于网格的计算停机计量的例子">
<meta property="og:url" content="http://zxkjack123.github.io/2019/05/16/neutronics/sample-trelis-dagmc-pyne-r2s-workflow/index.html">
<meta property="og:site_name" content="zxkjack123&#39;s blog">
<meta property="og:description" content="None">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://zxkjack123.github.io/neutronics/sample-trelis-dagmc-pyne-r2s-workflow/test_case1.png">
<meta property="og:image" content="http://zxkjack123.github.io/neutronics/sample-trelis-dagmc-pyne-r2s-workflow/trelis_geom_test_case1.png">
<meta property="article:published_time" content="2019-05-15T16:00:00.000Z">
<meta property="article:modified_time" content="2019-12-04T02:54:11.000Z">
<meta property="article:author" content="zxkjack123">
<meta property="article:tag" content="PyNE">
<meta property="article:tag" content="DAGMC">
<meta property="article:tag" content="Trelis">
<meta property="article:tag" content="R2S">
<meta property="article:tag" content="shutdown dose rate">
<meta property="article:tag" content="停机计量">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://zxkjack123.github.io/neutronics/sample-trelis-dagmc-pyne-r2s-workflow/test_case1.png">

<link rel="canonical" href="http://zxkjack123.github.io/2019/05/16/neutronics/sample-trelis-dagmc-pyne-r2s-workflow/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>使用PyNE进行基于网格的计算停机计量的例子 | zxkjack123's blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-113129784-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-113129784-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">zxkjack123's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/zxkjack123" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://zxkjack123.github.io/2019/05/16/neutronics/sample-trelis-dagmc-pyne-r2s-workflow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zxkjack123">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zxkjack123's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          使用PyNE进行基于网格的计算停机计量的例子
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-16 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-16T00:00:00+08:00">2019-05-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-12-04 10:54:11" itemprop="dateModified" datetime="2019-12-04T10:54:11+08:00">2019-12-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/neutronics/" itemprop="url" rel="index"><span itemprop="name">neutronics</span></a>
                </span>
            </span>

          
            <div class="post-description">None</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>本篇文章使用例子来说明使用PyNE来进行基于网格的计算停机剂量率的流程。</p>
<p>本流程需要提前安装Trelis, DAGMC, ALARA和PyNE。<br>DAGMC的安装可以参考<a href="https://zxkjack123.github.io/neutronics/dagmc-install/">这里</a>， PyNE的安装可以参考<a href="https://zxkjack123.github.io/neutronics/pyne-developer-install/">这里</a>。ALARA的安装可以参考<a href="https://zxkjack123.github.io/neutronics/alara-install/">这里</a>。</p>
<h2 id="例子的重要性"><a href="#例子的重要性" class="headerlink" title="例子的重要性"></a>例子的重要性</h2><p>使用的工具功能越多，那么使用起来一般就越复杂，新手就越难上手，新手总会在各种环节出现各种开发者意想不到的困难。即便软件官网上介绍了软件的各个工具的使用方法，但如果没有一个生动的例子来把这些应用工具的使用方法串起来的话，还是非常难的。</p>
<p>我自己作为一个PyNE系统的使用者，现在也参与了其中的部分开发工作，对此深有体会。对于新手的教学，告诉他们这个软件的各种功能是远远不够的，必须辅以实例，手把手的教会他们怎么用这个功能。用例子来说明这些问题是比较容易让新手接受的。我作为一个PyNE的使用者，也是一个新手。</p>
<p>这篇文章介绍了我如何从Trelis开始，一步一步实现计算一个简单模型的停机计量的过程的。</p>
<h2 id="例题描述"><a href="#例题描述" class="headerlink" title="例题描述"></a>例题描述</h2><p>现有如下形状的几何体：</p>
<center>
<br><img src="/neutronics/sample-trelis-dagmc-pyne-r2s-workflow/test_case1.png" width="300px"><br></center>
图中每个小快代表着$ 10 \times 10 \times 10 \, \mathrm{cm}^3$的立方体。简单起见，我们把栅元1和3的材料设为密度为$1.0 \, \mathrm{g/cm^3}$的水(Water)，栅元2的材料设为密度为$7.8 \, \mathrm{g/cm^3}$的钢(Steel)。除了这几个栅元外其它区域都是真空。栅元1的正中心有一个点中子源，各项同性的发射能量为14 MeV的中子。

<p>让点中子源以$10^{10}$个中子每秒的中子发射率辐照这几个栅元1年，然后停止辐照，考察停止辐照后1小时的栅元1, 2, 3的停机剂量率。</p>
<h2 id="输入文件准备"><a href="#输入文件准备" class="headerlink" title="输入文件准备"></a>输入文件准备</h2><p>要进行蒙特卡罗输运计算，我们需要提供以下信息：</p>
<ol>
<li>几何信息，包括栅元和曲面。</li>
<li>材料信息。每个区域（栅元）是什么材料（材料的组成份额）</li>
<li>中子源信息。</li>
<li>Tally信息。想统计的东西</li>
<li>其他信息。如截断卡，权重及权窗，计算终止条件等。</li>
</ol>
<p>与普通MCNP计算不同，使用DAGMC计算时这些信息并不是全部都由一个输入文件提供，而是分别通过不同的文件提供。一个加载了几何和材料信息的h5m文件提供几何和材料信息。而其他信息则通过另一个input文本文件提供。</p>
<h3 id="Trelis建模"><a href="#Trelis建模" class="headerlink" title="Trelis建模"></a>Trelis建模</h3><h4 id="几何体的建立"><a href="#几何体的建立" class="headerlink" title="几何体的建立"></a>几何体的建立</h4><p>使用Trelis建立3个立方体，并在立方体外围设置一个graveyard区域，所有到达graveyard区域的中子将被杀死。graveyard的设置可以参考DAGMC关于<a target="_blank" rel="noopener" href="https://svalinn.github.io/DAGMC/usersguide/codes/dag-mcnp.html?highlight=graveyard">graveyard的官方说明</a>。</p>
<center><br><img src="/neutronics/sample-trelis-dagmc-pyne-r2s-workflow/trelis_geom_test_case1.png"><br></center>
上图所示的三个小立方体块而就是我们建立的几个栅元，外面一个稍大的立方体薄壳就是我们想要的graveyard。
几何体分别标记为：
1. 蓝色小立方体，cell 1， trelis vol id: 1, 材料为密度为1的水，材料号设定为1
2. 黄色小立方体，cell 2, trelis vol id: 2, 材料为密度为7.8的铁，材料号设定为2
3. 红色小立方体块，cell 3, trelis vol id: 3， 材料为密度为1的水，材料号设定为1
4. 黄色大立方体薄壳，graveyard, trelis vol id: 8

<h4 id="分组并赋材料"><a href="#分组并赋材料" class="headerlink" title="分组并赋材料"></a>分组并赋材料</h4><p>几何体设置好了之后，对这几个栅元进行分组并赋材料。<br>在trelis界面输入下面命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">trelis&gt; group &quot;mat:Water&#x2F;rho:1.0&quot; add vol 1 3</span><br><span class="line">trelis&gt; group &quot;mat:Steel&#x2F;rho:7.8&quot; add vol 2</span><br></pre></td></tr></table></figure>
<p><strong>备注1</strong>：’trelis&gt;’代表该命令是在trelis窗口中执行。</p>
<h4 id="设置问题边界"><a href="#设置问题边界" class="headerlink" title="设置问题边界"></a>设置问题边界</h4><p>边界包括终止边界和反射边界等。终止边界指的是我们不关心的区域，中子进入到终止边界后就会被杀死，这和MCNP中<em>imp=0</em>的区域相似。反射边界就是反射面，中子到达反射面后会被反射回去，在对称几何中很常用。</p>
<h5 id="终止边界：graveyard"><a href="#终止边界：graveyard" class="headerlink" title="终止边界：graveyard"></a>终止边界：graveyard</h5><p>终止边界的设置实际上是通过对这个区域设置特殊材料实现的。比如此例题中需要将8号volume (可以简写为vol)设置为graveyard,可以使用下面命令进行设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trelis&gt; group &quot;mat:Graveyard&quot; add volume 8</span><br></pre></td></tr></table></figure>

<h5 id="反射边界"><a href="#反射边界" class="headerlink" title="反射边界"></a>反射边界</h5><p>反射边界是通过指定反射面的方式来设置的。与volume类似，我们可以把一些面加入到一个group，然后将这个group设置为反射面即可。反射面属性的设置也是通过把group名字设置为特殊字符串的方式实现。<br>比如将10, 11号曲面设置为反射面，可以通过下面的命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trelis&gt; group &quot;boundary:Reflecting&quot; add surf 10 11</span><br></pre></td></tr></table></figure>
<p>本例题中不需要将任何曲面设置为反射面。</p>
<h4 id="imprint-amp-merge"><a href="#imprint-amp-merge" class="headerlink" title="imprint &amp; merge"></a>imprint &amp; merge</h4><p>Imprint和merge是trelis中处理曲面的两个操作，他们的作用包括合并重合曲面和将无穷大的曲面根据几何体分割为总多的小的facet。功能说明可以参考<a target="_blank" rel="noopener" href="https://svalinn.github.io/DAGMC/usersguide/trelis_basics.html">trelis imprint and merge说明</a>。</p>
<p>我们需要做的是，在trelis界面执行下面的操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">trelis&gt; imprint body all</span><br><span class="line">trelis&gt; merge all</span><br></pre></td></tr></table></figure>

<h4 id="导出几何文件"><a href="#导出几何文件" class="headerlink" title="导出几何文件"></a>导出几何文件</h4><p>安装了DAGMC插件的trelis可以使用内置命令到处几何文件，使用方法可以通过下面命令查看帮助信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trelis&gt; help dagmc</span><br></pre></td></tr></table></figure>
<p>也可以参考<a target="_blank" rel="noopener" href="https://svalinn.github.io/DAGMC/usersguide/codes/dag-mcnp.html">官方文档</a>。</p>
<p>对于本例题，我们可以在trelis中执行下面命令将几何信息存放到”geometry1.h5m”中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trelis&gt; export dagmc geometry1.h5m</span><br></pre></td></tr></table></figure>
<p>至此，我们完成了几何文件的制作。</p>
<p><strong>注意：在没有设置trelis默认导出文件路径的情况下，此时生成的”geometry1.h5m”文件并不一定在当前文件夹，可能存放于$HOME/Documents中，也可能在其他常用默认文件夹中</strong></p>
<h3 id="制作材料"><a href="#制作材料" class="headerlink" title="制作材料"></a>制作材料</h3><p>我们需要首先制作本例题需要使用的材料库，包括Water和Steel两种材料。可以参考<a href="https://zxkjack123.github.io/neutronics/make-pyne-material-lib/">PyNE材料库制作</a>。</p>
<p>下面是制作本例子中的”Water”和”Steel”用到的python脚本文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line">#</span><br><span class="line">from pyne.material import Material,MaterialLibrary</span><br><span class="line">print &quot;Welcome!&quot;</span><br><span class="line">mat_lib&#x3D;MaterialLibrary()</span><br><span class="line">#</span><br><span class="line">mat2 &#x3D; Material(&#123;&#39;Fe&#39;:0.655,&#39;Cr&#39;:0.170,&#39;Ni&#39;:0.120,&#39;Mo&#39;: 0.025,&#39;Mn&#39;: 0.02, &#39;Si&#39;:.01&#125;,density&#x3D;7.92)</span><br><span class="line">mat2&#x3D;mat2.expand_elements()</span><br><span class="line">#</span><br><span class="line"># define a simple water since O-18 not in mcnp xs libs</span><br><span class="line">watervec&#x3D;&#123;10010:2,80160:1&#125; # simple water</span><br><span class="line">water &#x3D; Material()</span><br><span class="line">water.density &#x3D; 1.0</span><br><span class="line">water.from_atom_frac(watervec)</span><br><span class="line">#</span><br><span class="line">mat_lib[&quot;Steel&quot;]&#x3D;mat2</span><br><span class="line">mat_lib[&quot;Water&quot;]&#x3D;water</span><br><span class="line">#</span><br><span class="line">mat_lib.write_hdf5(&quot;test_material_lib.h5&quot;)</span><br><span class="line">#</span><br><span class="line">print &quot;All done!&quot;</span><br></pre></td></tr></table></figure>

<p>备注：制作材料的时候会调用PyNE，需要保证此时系统<strong>LD_LIBRARY_PATH</strong>中的MOAB是4.9.1版本的。</p>
<h3 id="整合几何与材料"><a href="#整合几何与材料" class="headerlink" title="整合几何与材料"></a>整合几何与材料</h3><p>按照UWUW流程制作材料，使用UWUW_preprocessor：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ uwuw_preproc &lt;dagmc h5m filename&gt; -v -l &lt;path to nuclear data library&gt;</span><br></pre></td></tr></table></figure>

<p>假设我们制作了材料库并存放在”material_lib1.h5”中，我们接下来就可以执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ uwuw_preproc geometry1.h5m -v -l material_lib1.h5</span><br></pre></td></tr></table></figure>

<h3 id="DAGMC-input文件准备"><a href="#DAGMC-input文件准备" class="headerlink" title="DAGMC input文件准备"></a>DAGMC input文件准备</h3><p>DAGMC的input文件中需要给定普通MCNP中除了栅元卡和曲面卡以及材料卡的其他部分，包括但不限于：</p>
<ol>
<li>中子源定义，必要项</li>
<li>计算终止条件，必要项</li>
<li>Tally卡，可选项，但一般都会有</li>
<li>其他功能性辅助卡，可选项，根据实际情况添加</li>
</ol>
<p>对于此例子的一个简单input文件如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">C test1 input</span><br><span class="line">C neutron source: point source, 14 MeV</span><br><span class="line">sdef pos&#x3D;0 0 0  erg&#x3D;14  </span><br><span class="line">C </span><br><span class="line">nps 1e5</span><br><span class="line">C Tally card</span><br><span class="line">fmesh4:n geom&#x3D;xyz origin&#x3D; -5 -5 -5</span><br><span class="line">         imesh&#x3D;15 iints&#x3D;2</span><br><span class="line">         jmesh&#x3D;5 jints&#x3D;1</span><br><span class="line">         kmesh&#x3D;15 kints&#x3D;2</span><br><span class="line">         emesh 0.1 20</span><br></pre></td></tr></table></figure>
<h2 id="中子输运计算"><a href="#中子输运计算" class="headerlink" title="中子输运计算"></a>中子输运计算</h2><p>使用DAGMC进行输运计算时，需要通过<strong>i=**来指定输入文件，通过</strong>g=**来指定加载了材料的几何文件，详细运行指令可以参考<a target="_blank" rel="noopener" href="https://svalinn.github.io/DAGMC/usersguide/uw2.html">官方文档</a>。</p>
<p>对于本例题，可以使用下面的方法运行本例子。<br>单线程运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 需要先保障系统能够找到正确的mcnp5.mpi，找不到的话需要给出完整路径</span><br><span class="line">mcnp5.mpi i&#x3D;input g&#x3D;geom.h5m</span><br></pre></td></tr></table></figure>

<p>多线程运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mpirun -np n mcnp5.mpi i&#x3D;input g&#x3D;geom.h5m</span><br></pre></td></tr></table></figure>
<p>备注：input文件和几何文件的名称长度都不能超过8个字符，可以使用<strong>ln -sf original_long_name.h5m geom.h5m</strong>把原文件链接到一个较短名字的文件后再运行。</p>
<p>计算完成之后，我们便得到了一个<strong>meshtal</strong>文件。</p>
<h2 id="活化计算"><a href="#活化计算" class="headerlink" title="活化计算"></a>活化计算</h2><p>中子输运完成后，我们开始正式调用PyNE的<a target="_blank" rel="noopener" href="http://pyne.io/usersguide/r2s.html?highlight=r2s">R2S计算</a>模块的功能进行停机剂量率计算了。</p>
<p>进行停机剂量率计算，我们需要的主要信息包括：</p>
<ol>
<li>每个网格单元的材料成分。必须项。由同时包含了几何和材料的geom.h5m文件提供。（此文件就是进行DAGMC计算的那个）</li>
<li>每个网格单元的中子通量能谱。必须项。由meshtal文件提供。</li>
<li>活化计算能力。必须项。由Analytic and Laplacian Adaptive Radioactivity Analysis软件:<a target="_blank" rel="noopener" href="https://github.com/svalinn/ALARA">ALARA</a>提供。</li>
<li>辐照及冷却方案。必须项。需要在R2S过程中指定。</li>
</ol>
<p>在我们的工作文件夹下新建一个子文件夹用来存放R2S计算相关的文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir r2s_run</span><br><span class="line"><span class="built_in">cd</span> r2s_run</span><br></pre></td></tr></table></figure>
<h3 id="初始化配置-setup"><a href="#初始化配置-setup" class="headerlink" title="初始化配置:setup"></a>初始化配置:setup</h3><p>初始化配置r2s。执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r2s.py setup</span><br></pre></td></tr></table></figure>

<p>执行之后我们应该能够看到下面的信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 一些warning</span><br><span class="line">File &quot;config.ini&quot; has been written</span><br><span class="line">File &quot;alara_params.txt&quot; has been written</span><br><span class="line">Fill out the fields in these filse then run &quot;&gt;&gt; r2s.py step1&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p><strong>setup</strong>这一步会生成两个文件：<strong>config.ini</strong>和<strong>alara_params.txt</strong>，我们需要修改这两个文件中的一些设置，包括辐照方案的设置和一些计算细节的设置。</p>
<h4 id="修改config-ini设置"><a href="#修改config-ini设置" class="headerlink" title="修改config.ini设置"></a>修改<strong>config.ini</strong>设置</h4><p>一般情况下，我们需要注意的几个设置是：</p>
<ol>
<li>structured: 是否是结构化网格。结构化网格就是指MCNP中用的xyz或cyl网格。我们应该选<strong>True</strong></li>
<li>sub_voxel: 是否采用sub_voxel模式，sub_voxel模式是我正在添加的代码，还没有完成，暂时不能选用，因此是False</li>
<li>reverse: 反转中子通量顺序。DAGMC输出的中子通量是按照从低能到高能排序，而用ALARA进行活化计算时需要按照从高能到低能读取，因此需要把中子通量逆序排列。这里填True。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[general]</span><br><span class="line"><span class="comment"># Specify whether this problem uses structured or unstructured mesh</span></span><br><span class="line">structured: <span class="literal">True</span></span><br><span class="line"><span class="comment"># Specify whether this problem uses sub-voxel r2s</span></span><br><span class="line">sub_voxel: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">[step1]</span><br><span class="line"><span class="comment"># Path to MCNP MESHTAL file containing neutron fluxes or a DAG-MCNP5</span></span><br><span class="line"><span class="comment"># unstructured mesh tally .h5m file.</span></span><br><span class="line">meshtal: meshtal</span><br><span class="line"><span class="comment"># Tally number within the meshtal file containing the fluxes for activation.</span></span><br><span class="line">tally_num: <span class="number">4</span></span><br><span class="line"><span class="comment"># The name of the tag used to store flux data on the mesh. For unstructured</span></span><br><span class="line"><span class="comment"># mesh this tag must already exist within the file specified in &lt;meshtal&gt;.</span></span><br><span class="line">flux_tag: n_flux</span><br><span class="line"><span class="comment"># Path to the DAGMC material-laden geometry file (.h5m).</span></span><br><span class="line">geom: geom.h5m</span><br><span class="line"><span class="comment"># If True the fluxes in the fluxin file will be printed in the reverse</span></span><br><span class="line"><span class="comment"># order of how they appear within the flux vector tag. Since MCNP and</span></span><br><span class="line"><span class="comment"># the Meshtal class order fluxes from low energy to high energy, this</span></span><br><span class="line"><span class="comment"># option should be true if the transmutation data being used is</span></span><br><span class="line"><span class="comment"># ordered from high-energy to low-energy.</span></span><br><span class="line">reverse: <span class="literal">True</span></span><br><span class="line"><span class="comment"># Number of rays to fire down each mesh row in each direction to calculate</span></span><br><span class="line"><span class="comment"># cell volume fractions.</span></span><br><span class="line">num_rays: <span class="number">10</span></span><br><span class="line"><span class="comment"># If true, rays will be fired down mesh rows in evenly spaced intervals.</span></span><br><span class="line"><span class="comment"># In this case &lt;num_rays&gt; must be a perfect square. If false, rays are fired</span></span><br><span class="line"><span class="comment"># down mesh rows in random intervals.</span></span><br><span class="line">grid: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">[step2]</span><br><span class="line"><span class="comment"># List of decays times, seperated by commas. These strings much match exactly</span></span><br><span class="line"><span class="comment"># with their counterparts in the phtn_src file produced in step1. No spaces</span></span><br><span class="line"><span class="comment"># should appear in this line except the space between the time and the time unit</span></span><br><span class="line"><span class="comment"># for each entry.</span></span><br><span class="line">decay_times:<span class="number">1</span> h</span><br><span class="line"><span class="comment"># The prefix of the .h5m files containing the source density distributations for</span></span><br><span class="line"><span class="comment"># each decay time.</span></span><br><span class="line">output: source</span><br><span class="line"><span class="comment"># The name of the output files containing the total photon source intensities for</span></span><br><span class="line"><span class="comment"># each decay time</span></span><br><span class="line">tot_phtn_src_intensities : total_photon_source_intensites.txt</span><br></pre></td></tr></table></figure>

<h4 id="修改alara-params-txt"><a href="#修改alara-params-txt" class="headerlink" title="修改alara_params.txt"></a>修改alara_params.txt</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">material_lib alara_matlib</span><br><span class="line">element_lib data&#x2F;nuclib</span><br><span class="line">data_library alaralib data&#x2F;truncated_fendl2bin</span><br><span class="line"></span><br><span class="line">cooling</span><br><span class="line">    1 h</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">output zone</span><br><span class="line">       integrate_energy</span><br><span class="line">       # Energy group upper bounds. The lower bound is always zero.</span><br><span class="line">       photon_source  data&#x2F;truncated_fendl2bin  phtn_src 24 1.00E4 2.00E4 5.00E4 1.00E5</span><br><span class="line">       2.00E5 3.00E5 4.00E5 6.00E5 8.00E5 1.00E6 1.22E6 1.44E6 1.66E6</span><br><span class="line">       2.00E6 2.50E6 3.00E6 4.00E6 5.00E6 6.50E6 8.00E6 1.00E7 1.20E7</span><br><span class="line">       1.40E7 2.00E7</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">#     flux name    fluxin file   norm   shift   unused</span><br><span class="line">flux  my_flux     alara_fluxin  1e10     0      default</span><br><span class="line"></span><br><span class="line"># Specify the irradiation schedule below.</span><br><span class="line"># Syntax is found in the ALARA user manual</span><br><span class="line"># This example is for a single 1 y pulse</span><br><span class="line">schedule    my_schedule</span><br><span class="line">    1 y my_flux my_pulse_history 0  s</span><br><span class="line">end</span><br><span class="line">pulsehistory  my_pulse_history</span><br><span class="line">    1    0.0    s</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">#other parameters</span><br><span class="line">truncation 1e-12</span><br><span class="line">impurity 5e-6 1e-3</span><br><span class="line">dump_file dump.file</span><br></pre></td></tr></table></figure>

<h3 id="r2s-py-step1"><a href="#r2s-py-step1" class="headerlink" title="r2s.py step1"></a>r2s.py step1</h3><p><strong>r2s.py step1</strong>是用来根据<strong>r2s.py setup</strong>生成的配置文件生成ALARA输入文件，中子通量文件和ALARA材料库文件的。</p>
<p>当我们修改好上面两个文件后，就可以使用r2s.py生成ALARA计算需要的文件了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ r2s.py step1</span><br></pre></td></tr></table></figure>


<h3 id="材料数据库准备"><a href="#材料数据库准备" class="headerlink" title="材料数据库准备"></a>材料数据库准备</h3><p><strong>ALARA输入文件</strong>中有三行是<strong>材料数据库</strong>相关的信息。</p>
<ol>
<li>material_lib alara_matlib 这个<strong>alara_matlib</strong>是alara需要读取的材料成功定义的文件名。这个文件是会由程序从test1_geometry.h5m (geom.h5m)中读取的，不需要做修改。</li>
<li>element_lib data/nuclib 这个文件是定义元素的丰度用的。默认是自然丰度，也可以自己定义修改丰度。自己定义一个元素丰度数据表显然是非常麻烦的，在ALARA的安装文件中$ALARA/data下有一个<strong>elelib.std</strong>，可以把这个文件拷贝到工作文件夹下并重命名为<strong>nucib</strong>即可（也可以设置element_lib elelib.std)。但是这个<strong>elelib.std</strong>只能用于材料定义是按照元素定义的，如果有针对核素的定义，则这个就不能用了。需要将元素扩展成核素，需要后续介的方法单独处理。</li>
<li>data_library alaralib truncated_fendl2bin （ALARA应该配备fendl3bin)但是并没有，ALARA安装文件中的sample/datam文件夹下只有truncated_fendl2bin数据库。我们可以把这个数据库相关的文件拷贝到工作文件夹。</li>
</ol>
<p>当材料定义是针对核素定义了的化，普通的<strong>elelib.std</strong>就没办法使用了，会出现错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">310: Could not find element &lt;string&gt; in element library.</span><br><span class="line"></span><br><span class="line">The element string was not found in the element library. This could be due to an error in the material library, incorrect user input, or an omission in the element library.</span><br><span class="line">&#96;&#96;&#96; </span><br><span class="line">这时我们需要使用工具**elelib_to_nuclib.py**来将元素扩展成核素数据。这个工具是一个python脚本，调用pyne数据模块扩展元素数据。工具的位置在ALARA源文件的tools文件夹下，使用方法：</span><br><span class="line">&#96;&#96;&#96;bash</span><br><span class="line">$ cd r2s_run&#x2F;data</span><br><span class="line">$ python &lt;path_to_elelib_to_nuclib.py&gt; elelib_std -o nuclib</span><br></pre></td></tr></table></figure>



<h3 id="alara计算"><a href="#alara计算" class="headerlink" title="alara计算"></a>alara计算</h3><p>当<strong>step1</strong>完成后，程序会给出运行alara的提示，按照提示运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ alara alara_inp &gt; output.txt</span><br></pre></td></tr></table></figure>
<p>等待alara运行完成，会生成几个文件：</p>
<ol>
<li>output.txt: ALARA输出文件，里面有活化后材料的核素组成以及光子发射率数据</li>
<li>phtn_src: ALARA输出文件，里面有详细的各个各个材料各个核素缠身的各个能群的光子数据</li>
</ol>
<h3 id="r2s-step2"><a href="#r2s-step2" class="headerlink" title="r2s step2"></a>r2s step2</h3><p>ALARA计算完成后，运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ r2s.py step2</span><br></pre></td></tr></table></figure>
<p>执行完成后，我们可以看到工作文件夹中多了几个文件：</p>
<ol>
<li>e_bounds:光子能群结构。从低能到高能，单位为eV。最低能群能量下限为0.</li>
<li>phtn_src.h5: HDF5格式的光子源数据，无法直接打开读取，只能程序读。</li>
<li>source_<strong>i</strong>.h5m: 第<strong>i</strong>个冷却时间点的网格光子源数据。</li>
<li>total_photon_source_intensites.txt: 里面是各个冷却时间节点的总光子发射率。<br>你</li>
</ol>
<h2 id="光子输运"><a href="#光子输运" class="headerlink" title="光子输运"></a>光子输运</h2><p>获得光子源后，我们就可以进行光子输运计算了。计算前必须确认DAGMC是已经包含了源子程序的版本，如果没有，需要先参考<a href="%E7%BC%96%E8%AF%91%E5%B8%A6%E7%94%A8%E4%BA%8ER2S%E7%9A%84%E6%BA%90%E5%AD%90%E7%A8%8B%E5%BA%8F%E7%9A%84DAGMC">编译带用于R2S的源子程序的DAGMC</a>安装DAGMC。</p>
<h3 id="文件准备"><a href="#文件准备" class="headerlink" title="文件准备"></a>文件准备</h3><p>进行光子输运计算，我们需要提供几何文件，材料，光子源，以及需要统计的信息。因此需要准备的文件有：</p>
<ol>
<li>geom.h5m: 就是中子输运时用的那个文件，即本例子中的test1_geometry.h5m，它包含了几何和材料信息</li>
<li>source.h5m:光子源信息文件，源子程序需要从这里读取信息。由于MCNP无法从输入文件中传递字符串，所以这个文件名称不能改变，必须是source.h5m。</li>
<li>e_bounds: 光子能群结构文件。</li>
<li>input: 提供tally信息，另外需要在这个文件中定义<strong>idum</strong>，用于控制源子程序过程。</li>
</ol>
<p>准备好这些文件后，我们还需要对这些文件进行一些小修改。</p>
<ol>
<li>input文件修改：首先，需要加上mode p， 然后修改tally部分。</li>
<li>e_bounds: 这个文件中的能群单位是eV而不是MeV，需要手动将里面的数据单位除以1e6。（在github上提交该修改建议）</li>
</ol>
<p>我们还需要修改栅元的重要性，因为中子输运时的文件里面的重要性是默认为中子的重要性，没有光子的重要性。但是这个重要性信息是写在h5m文件里面的，没法直接修改。</p>
<p>我们需要先运行一次这个文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mcnp5.mpi i=input g=geom.h5m</span><br></pre></td></tr></table></figure>
<p>现在这个运行肯定会出现错误，说粒子产生子重要性为0的区域。但是同时这个过程会生成一个可编辑的<strong>lcad</strong>文件，我们可以修改这个<strong>lcad</strong>文件，在重要性部分添加上<strong>imp:p=1</strong>/<strong>imp:p=0</strong>，将这个文件重命名为<strong>lcad_m</strong>，删掉过程文件<strong>fcad, outp, runtpe</strong>后再次运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mcnp5.mpi i=input g=geom.h5m l=lcad_m</span><br></pre></td></tr></table></figure>
<p>之后就得到结果，至此停机剂量的计算完成。</p>
<p><strong>备注</strong>：在计算得到结果之后，还可以把几何图形及计算结果的网格数据进行可视化绘图。绘图方法可以参考<a href="https://zxkjack123.github.io/neutronics/dagmc-geom-data-visualization/">DAGMC数据绘图</a>。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/PyNE/" rel="tag"># PyNE</a>
              <a href="/tags/DAGMC/" rel="tag"># DAGMC</a>
              <a href="/tags/Trelis/" rel="tag"># Trelis</a>
              <a href="/tags/R2S/" rel="tag"># R2S</a>
              <a href="/tags/shutdown-dose-rate/" rel="tag"># shutdown dose rate</a>
              <a href="/tags/%E5%81%9C%E6%9C%BA%E8%AE%A1%E9%87%8F/" rel="tag"># 停机计量</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/05/16/ubuntu/vim-copy-to-clipboard/" rel="prev" title="Vim-复制内容到vim外">
      <i class="fa fa-chevron-left"></i> Vim-复制内容到vim外
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/05/16/cython/cython-return-object/" rel="next" title="Cython返回Python类对象">
      Cython返回Python类对象 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E"><span class="nav-number">1.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7"><span class="nav-number">2.</span> <span class="nav-text">例子的重要性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-number">3.</span> <span class="nav-text">例题描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E6%96%87%E4%BB%B6%E5%87%86%E5%A4%87"><span class="nav-number">4.</span> <span class="nav-text">输入文件准备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Trelis%E5%BB%BA%E6%A8%A1"><span class="nav-number">4.1.</span> <span class="nav-text">Trelis建模</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E5%BB%BA%E7%AB%8B"><span class="nav-number">4.1.1.</span> <span class="nav-text">几何体的建立</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E5%B9%B6%E8%B5%8B%E6%9D%90%E6%96%99"><span class="nav-number">4.1.2.</span> <span class="nav-text">分组并赋材料</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E9%97%AE%E9%A2%98%E8%BE%B9%E7%95%8C"><span class="nav-number">4.1.3.</span> <span class="nav-text">设置问题边界</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%88%E6%AD%A2%E8%BE%B9%E7%95%8C%EF%BC%9Agraveyard"><span class="nav-number">4.1.3.1.</span> <span class="nav-text">终止边界：graveyard</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E8%BE%B9%E7%95%8C"><span class="nav-number">4.1.3.2.</span> <span class="nav-text">反射边界</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#imprint-amp-merge"><span class="nav-number">4.1.4.</span> <span class="nav-text">imprint &amp; merge</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E5%87%A0%E4%BD%95%E6%96%87%E4%BB%B6"><span class="nav-number">4.1.5.</span> <span class="nav-text">导出几何文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%B6%E4%BD%9C%E6%9D%90%E6%96%99"><span class="nav-number">4.2.</span> <span class="nav-text">制作材料</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E5%90%88%E5%87%A0%E4%BD%95%E4%B8%8E%E6%9D%90%E6%96%99"><span class="nav-number">4.3.</span> <span class="nav-text">整合几何与材料</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DAGMC-input%E6%96%87%E4%BB%B6%E5%87%86%E5%A4%87"><span class="nav-number">4.4.</span> <span class="nav-text">DAGMC input文件准备</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E5%AD%90%E8%BE%93%E8%BF%90%E8%AE%A1%E7%AE%97"><span class="nav-number">5.</span> <span class="nav-text">中子输运计算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B4%BB%E5%8C%96%E8%AE%A1%E7%AE%97"><span class="nav-number">6.</span> <span class="nav-text">活化计算</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE-setup"><span class="nav-number">6.1.</span> <span class="nav-text">初始化配置:setup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">6.2.</span> <span class="nav-text">修改配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9config-ini%E8%AE%BE%E7%BD%AE"><span class="nav-number">6.2.1.</span> <span class="nav-text">修改config.ini设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9alara-params-txt"><span class="nav-number">6.2.2.</span> <span class="nav-text">修改alara_params.txt</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#r2s-py-step1"><span class="nav-number">6.3.</span> <span class="nav-text">r2s.py step1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%90%E6%96%99%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87"><span class="nav-number">6.4.</span> <span class="nav-text">材料数据库准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#alara%E8%AE%A1%E7%AE%97"><span class="nav-number">6.5.</span> <span class="nav-text">alara计算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#r2s-step2"><span class="nav-number">6.6.</span> <span class="nav-text">r2s step2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%89%E5%AD%90%E8%BE%93%E8%BF%90"><span class="nav-number">7.</span> <span class="nav-text">光子输运</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%87%86%E5%A4%87"><span class="nav-number">7.1.</span> <span class="nav-text">文件准备</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zxkjack123</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">127</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zxkjack123" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zxkjack123" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zxkjack123@163.com" title="E-Mail → mailto:zxkjack123@163.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zxkjack123</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
